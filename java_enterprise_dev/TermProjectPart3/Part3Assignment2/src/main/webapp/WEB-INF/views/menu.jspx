<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<div id="menu" xmlns:jsp="http://java.sun.com/JSP/Page"
     xmlns:spring="http://www.springframework.org/tags"
     xmlns:sec="http://www.springframework.org/security/tags"
     version="2.0">
    <jsp:directive.page contentType="text/html;charset=UTF-8" />
    <jsp:output omit-xml-declaration="yes" />

    <!-- add spring messaging for i18n -->
    <spring:message code="menu_title" var="menuTitle"/>
    <spring:message code="menu_all_books" var="menuAllBooks" />
    <spring:message code="menu_add_book" var="menuAddBook"/>
    <spring:message code="label_login" var="labelLogin"/>
    <spring:message code="label_username" var="labelUsername"/>
    <spring:message code="label_password" var="labelPassword"/>

    <!-- add spring urls for listing and adding books -->
    <spring:url value="/books" var="listBooksUrl"/>
    <spring:url value="/books?form" var="addBookUrl"/>
    <spring:url var="loginUrl" value="/login" />

    <!-- create sidebar menu that links to all books and create a new book -->
    <div class="card">
        <div class="card-header">
            ${menuTitle}
        </div>

        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link" href="${listBooksUrl}">${menuAllBooks}</a>
            </li>

            <!-- only show new book is user is logged in -->
            <sec:authorize access="hasRole('ROLE_USER')">
                <li class="nav-item">
                    <a class="nav-link" href="${addBookUrl}">${menuAddBook}</a>
                </li>
            </sec:authorize>

            <!-- otherwise show the login prompt -->
            <sec:authorize access="isAnonymous()">
                <div id="login" class="nav-link">
                    <form name="loginForm" action="${loginUrl}" method="post">
                        <div class="form-group">
                            <label>${labelLogin}</label>
                            <input type="text" class="form-control form-control-sm"  placeholder="${labelUsername}" name="username"/>
                            <small class="form-text text-muted">The username is "user"</small>
                        </div>
                        <div class="form-group">
                            <input type="password" class="form-control form-control-sm" placeholder="${labelPassword}" name="password"/>
                            <small class="form-text text-muted">The password is "password"</small>
                        </div>
                        <button name="submit" type="submit" value="Login" class="btn btn-primary btn-sm">${labelLogin}</button>
                    </form>
                </div>
            </sec:authorize>

        </ul>
    </div>
</div>